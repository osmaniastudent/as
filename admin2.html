<html>
<head>
<style>
.main{

}
.flex{display: flex;justify-content: space-around;padding:10px;}
.flexc{display:flex;border:2px solid black;background:#d6bc14;}
#tools{}
#tools div{display:flex;align-items:center;}
.labtc{
	display:inline-flex;
	align-items:center;
	font-family:monospace;
	font-size:17px;
}
.inptc{
    width: 20px;
    height: 20px;
}
.apb{min-width:61px;min-height:25px;border-right:2px solid black;background-color:seashell;width:fit-content;text-align:center;padding:4px;font-size:30px;font-family: monospace;}
.flexab{display:flex;border:2px solid black;background:#d6bc14;}
.flexpr{display:none;border:2px solid black;background:#d6bc14;}
.apba{min-width:61px;min-height:25px;border-right:2px solid black;background-color:seashell;width:fit-content;text-align:center;padding:4px;font-size:30px;font-family: monospace;}
.apbab{width:45px;height:45px;background:url('abs.png');background-size:contain;border:5px solid #d6bc14;}
.apbpr{width:45px;height:45px;background:url('pre.png');background-size:contain;border:5px solid #d6bc14;}

.flexcb{display:none;border:2px solid black;background:#d6bc14;}
</style>
<script src="sam.js"></script>
</head>
<body onload="loaded()">
<div id="bodya" style="display:none;">
<div id="tools">
<!--<button type="button" style="display:block;width:50%;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;margin:auto;" onclick='fetap()'>Refresh</button>-->
</div>
<div id="atctrl">
<div style="border:solid 2px black;margin-top:10px;">
<div style="display:block;width:auto;border-bottom:solid 2px black;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;" onclick="if(this.style.backgroundColor =='red'){document.getElementById('absudbox').style.display='none';this.style.borderBottom='none';this.style.backgroundColor ='aqua';}else{document.getElementById('absudbox').style.display='flex';this.style.borderBottom='solid 2px black';this.style.backgroundColor ='red';}">Absent Students</div>
<div class="flex" id="absudbox" style="flex-wrap:wrap;">
</div>
</div>

<div style="border:solid 2px black;margin-top:10px;">
<div style="display:block;width:auto;border-bottom:solid 2px black;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;" onclick="if(this.style.backgroundColor =='red'){document.getElementById('presudbox').style.display='none';this.style.borderBottom='none';this.style.backgroundColor ='aqua';}else{document.getElementById('presudbox').style.display='flex';this.style.borderBottom='solid 2px black';this.style.backgroundColor ='red';}">Present Students</div>
<div class="flex" id="presudbox" style="flex-wrap:wrap;">
</div>
</div>

<div style="border:solid 2px black;margin-top:10px;">
<div style="display:block;width:auto;border-bottom:solid 2px black;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;" onclick="if(this.style.backgroundColor =='red'){document.getElementById('chngb').style.display='none';this.style.borderBottom='none';this.style.backgroundColor ='aqua';}else{document.getElementById('chngb').style.display='flex';this.style.borderBottom='solid 2px black';this.style.backgroundColor ='red';}">Changed To</div>
<div class="flex" id="chngb" style="flex-wrap:wrap;">
</div>
</div>
</div>
<button type="button" style="display:block;width:50%;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;margin:auto;" onclick='subdataalrt();'>Submit</button>
<div id="tdiv" style="display:none;"></div>
</div>
<script>
//https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/sendmessage?chat_id=-1001310291767&text=bye

var arr = [[]];

var prel=[], absl=[], copl=[], rcl=[];
var absbbstr='', prebstr='', chngbstr='';

var absbox=document.getElementById("absudbox"), prebox=document.getElementById("presudbox"), chngbv=document.getElementById("chngb"), tdiv=document.getElementById("tdiv");
var pal=[], tmpstr, setroom, coder;

var apba='<div class="flexab" id="apbae', apbp='<div class="flexpr" id="apbpe', apb2='"><div class="apb">', apb3='</div><button class="apbab" onclick="clkabs(', apb4='</div><button class="apbpr" onclick="clkpre(', apb5=')"></button></div>';

var cba='<div class="flexcb" id="cbae', cbp='<div class="flexcb" id="cbpe', cb2='"><div class="apb">', cb3='</div><div class="apbab"></div></div>', cb4='</div><div class="apbpr"></div></div>';

var lv;

function loaded(){
    //__github.io/____#juuuuuuuuuuuuuuuuuuu
   var urlhsha = (window.location.href.split("?"));
   var urlhsh = urlhsha[1].split("zzz");
   document.getElementById("bodya").style.display="block";
   setroom = urlhsh[0];

coder = (((Number(urlhsh[1])-9)/77)).toString();
swal({
  text: 'Enter the Code',
  content: "input",
  button: {
    text: "Enter",
    closeModal: false,
  },
})
.then(cod => {
  if (cod == coder){
    document.getElementById("bodya").style.display="block";
    swal("Correct");
    fetap();
  }else{
	swal("Incorrect");
  }
})
}
function fetap(){
   prel=[], absl=[], copl=[], rcl=[];
   var xhttp = new XMLHttpRequest();
   xhttp.responseType = 'json';
   xhttp.onreadystatechange = function(){if (this.readyState == 4 && this.status == 200) {
   var resp = this.response;
   absbbstr='';
   prebstr='';
   chngbstr='';
   for (item in resp){
       if (item == "tmp"){

       }else{
	absbbstr+=apba+item+apb2+item+apb3+item+apb5;
	prebstr+=apbp+item+apb2+item+apb4+item+apb5;
	chngbstr+=cba+item+cb2+item+cb3+cbp+item+cb2+item+cb4;
       }
   }
   absbox.innerHTML=absbbstr;
   prebox.innerHTML=prebstr;
   chngbv.innerHTML=chngbstr;
   for (items in resp){
      if(resp[items]=='A'){
	    absl.push(Number(items));
        copl.push(Number(items));
      }else if(resp[items]=='P'){
		document.getElementById("apbae"+items).style.display="none";
		document.getElementById("apbpe"+items).style.display="flex";
	    prel.push(Number(items));
        copl.push(Number(items));
      }
   }
   }};
   xhttp.open("GET", ('https://fitbeau-5606d.firebaseio.com/room/room'+setroom+'/apcl/.json'), true);
   xhttp.send();
}

function clkpre(rollnoc){
	    absl.push(rollnoc);
		absl.sort(function(a, b){return a-b});
		prel.splice(prel.indexOf(rollnoc),1);
		document.getElementById("apbae"+rollnoc).style.display="flex";
		document.getElementById("apbpe"+rollnoc).style.display="none";
		if(rcl.includes(rollnoc)){
			rcl.splice(rcl.indexOf(rollnoc),1);
			document.getElementById("cbpe"+rollnoc).style.display="none";
		}else{
			rcl.push(rollnoc);
			rcl.sort(function(a, b){return a-b});
			document.getElementById("cbae"+rollnoc).style.display="flex";
		}
}
function clkabs(rollnoc){
	    prel.push(rollnoc);
		prel.sort(function(a, b){return a-b});
		absl.splice(absl.indexOf(rollnoc),1);
		document.getElementById("apbae"+rollnoc).style.display="none";
		document.getElementById("apbpe"+rollnoc).style.display="flex";
		if(rcl.includes(rollnoc)){
			rcl.splice(rcl.indexOf(rollnoc),1);
			document.getElementById("cbae"+rollnoc).style.display="none";
		}else{
			rcl.push(rollnoc);
			rcl.sort(function(a, b){return a-b});
			document.getElementById("cbpe"+rollnoc).style.display="flex";
		}
}
// end of click events


function subdataalrt(){
    swal({title: "Are you sure?",text: "It will Submit data and stop You",icon: "warning",buttons: true,dangerMode: true,}).then((value) => {if(value){swal({icon: "success",title:"Done",text:"Submit started"});subdata();}else{swal({title:"Cancelled Process",icon:"info"});}});
}

function subdata(){
   var jsonstr = '{';
   var xhttp = new XMLHttpRequest();
   xhttp.responseType = 'json';
   xhttp.onreadystatechange = function(){if (this.readyState == 4 && this.status == 200) {
   var resp = this.response;
   for (index in resp){
		if (rcl.includes(Number(index))){
			if (prel.includes(Number(index))){
				jsonstr += ('"'+index+'":"P",');
			}else if (absl.includes(Number(index))){
				jsonstr += ('"'+index+'":"A",');
			}
		}else if(index == "tmp"){
			
		}else{
			jsonstr += ('"'+index+'":"'+resp[index]+'",');
		}
   }
	jsonstr += '"tmp":"t"}';
	var xhtto = new XMLHttpRequest();
	xhtto.onreadystatechange = function(){if(this.readyState == 4 && this.status == 200){
		document.getElementById("bodya").innerHTML='';
		swal({title:"Submited",icon:"info",text:"Submition Complete"});
	}};
	xhtto.open("PUT", ('https://fitbeau-5606d.firebaseio.com/room/room'+setroom+'/apcl.json'), true);
	xhtto.setRequestHeader("Content-Type", "application/json");
	xhtto.send(jsonstr);
   }};
   xhttp.open("GET", ('https://fitbeau-5606d.firebaseio.com/room/room'+setroom+'/apcl/.json'), true);
   xhttp.send();
}
	
function info(rn){
  //swal({title:(rn+" is:"),icon:"info",text:(arr[Number(rn)][1])});
}
/*

*/

</script>
</body>
</html>
