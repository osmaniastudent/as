<html>
<head>
<style>
.main{

}
.each{
    background-color: #d6bc14;
    width: 100%;
    align-items: center;
    border: 2px solid black;
}
.rn{
  min-width: 61px;
  min-height: 25px;
  border-right: 2px solid black;
  border-left: 2px solid black;
  background-color: seashell;
  width: fit-content;
  text-align: center;
  padding: 2px;
  font-size: 30;
  font-family: monospace;
}
.pa{
    display: flex;
    flex-direction: row;
    column-gap: 5px;
}
.rnb{
    display: flex;
    flex-direction: row;
}
.pre{
  width:45px;
  height:45px;
  background:url('pre.png');
  background-size:contain;
  border: 5px solid lime;
}
.abs{
  width:45px;
  height:45px;
  background:url('abs.png');
  background-size:contain;
  border: 5px solid red;
}
.imgtr{
   min-width:50px;
   max-height:22px;
   font-size: 20px;
   font-family: monospace;
   border: 1px solid black;
}
.imgta{
   min-width:30px;
   font-size: 20px;
   font-family: monospace;
   border: 1px solid black;
}
thead{background-color:orange;}
td{text-align:center;border:1px solid black;}
tr{border:1px solid black;}
table{border-spacing: 0px;}

.flex{display: flex;justify-content: space-around;padding:10px;}
.flexc{display:flex;border:2px solid black;background:#d6bc14;}
#tools{}
#tools div{display:flex;align-items:center;}
.labtc{
	display:inline-flex;
	align-items:center;
	font-family:monospace;
	font-size:17px;
}
.inptc{
    width: 20px;
    height: 20px;
}
.apb{min-width:61px;min-height:25px;border-right:2px solid black;background-color:seashell;width:fit-content;text-align:center;padding:4px;font-size:30px;font-family: monospace;}
.apbab{width:45px;height:45px;background:url('abs.png');background-size:contain;border:5px solid #d6bc14;}
.apbpr{width:45px;height:45px;background:url('pre.png');background-size:contain;border:5px solid #d6bc14;}
</style>
<script src="h2c.js"></script>
<script src="jm.js"></script>
<script src="jtm.js"></script>
<link rel="stylesheet" href="jtm.css"/>
<script src="sam.js"></script>
</head>
<body>
<div id="bodya">
<div id="tools">

<div class="flex">
<form style="justify-content:space-around;display:flex;">
<label class="labtc" style="flex-direction:column;">Subject:<input type="text" list="subjs" id="subji"/><datalist id="subjs" style="height:30%;overflow-y:auto;"><option>Microbiology</option><option>Pathology</option><option>Pharmacology</option><option>Forensic-Medicine</option><option>Preventive-Medicine</option></datalist>
</label>
<label class="labtc" style="flex-direction:column;">Faculty:<input type="text" list="facts" id="facti" /><datalist id="facts" style="height:30%;overflow-y:auto;"><option></option></datalist>
</label>
<label class="labtc" style="flex-direction:column;">Time Start-End:<input type="text" placeholder="Start" id="strtimpic"/><input type="text" placeholder="End" id="endtimpic"/><button class="labtc" type="button" id="endtimbut">Set Current</button>
</label>
</form>
</div>

<div class="flex" style="">
<form style="justify-content:space-around;display:flex;margin-block-end:0px;column-gap:10px;">
<label class="labtc">A:<input class="inptc" type="checkbox" id="bata"></label>
<label class="labtc">B:<input class="inptc" type="checkbox" id="batb"></label>
<label class="labtc">C:<input class="inptc" type="checkbox" id="batc"></label>
</form>
</div>
<div class="flex" style="justify-content:center;column-gap:6px;">
<button class="labtc" type="button" onclick="toolchk(1)">Uncheck-All</button>
<button class="labtc" type="button" onclick="toolchk(2)">Check-All</button>
</div>

<button type="button" id="crsbut" style="display:block;width:50%;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;margin:auto;" onclick='crtshtini();'>Create Sheet</button>
<button type="button" style="display:block;width:50%;background-color:aqua;font-family:monospace;font-size:20px;text-align:center;padding:8px;margin:auto;margin-top:5px;" onclick='refreshl()'>Refresh Data</button>
<button type="button" style="display:block;width:50%;background-color:aqua;font-family:monospace;font-size:20px;text-align:center;padding:8px;margin:auto;margin-top:5px;" onclick='sendimg(document.getElementById("finallook"));'>Send Attendance</button>
<button type="button" style="display:block;width:50%;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;margin:auto;margin-top:5px;" onclick='endatts()'>End Attendance System</button>
</div>
<div id="help" style="display:none;">
<div id="info"></div>
<div id="kode" style="width:50%;background-color:aqua;font-size:15px;padding:4px;margin:auto;margin-top:3px;"></div>
</div>
<div id="atctrl">
<div style="border:solid 2px black;margin-top:10px;">
<div style="display:block;width:auto;border-bottom:solid 2px black;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;" onclick="if(this.style.backgroundColor =='red'){document.getElementById('absudbox').style.display='none';this.style.borderBottom='none';this.style.backgroundColor ='aqua';}else{document.getElementById('absudbox').style.display='flex';this.style.borderBottom='solid 2px black';this.style.backgroundColor ='red';}">Absent Students</div>
<div class="flex" id="absudbox" onclick="onclk(event);" style="flex-wrap:wrap;">
</div>
</div>

<div style="border:solid 2px black;margin-top:10px;">
<div style="display:block;width:auto;border-bottom:solid 2px black;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;" onclick="if(this.style.backgroundColor =='red'){document.getElementById('presudbox').style.display='none';this.style.borderBottom='none';this.style.backgroundColor ='aqua';}else{document.getElementById('presudbox').style.display='flex';this.style.borderBottom='solid 2px black';this.style.backgroundColor ='red';}">Present Students</div>
<div class="flex" id="presudbox" onclick="onclk(event);" style="flex-wrap:wrap;">
</div>
</div>

<div style="border:solid 2px black;margin-top:10px;">
<div style="display:block;width:auto;border-bottom:solid 2px black;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;" onclick="if(this.style.backgroundColor =='red'){document.getElementById('chngb').style.display='none';this.style.borderBottom='none';this.style.backgroundColor ='aqua';}else{document.getElementById('chngb').style.display='flex';this.style.borderBottom='solid 2px black';this.style.backgroundColor ='red';}">Changed To</div>
<div class="flex" id="chngb" style="flex-wrap:wrap;">
</div>
</div>

<div style="border:solid 2px black;margin-top:10px;">
<div style="display:block;width:auto;border-bottom:none;background-color:aqua;font-family:monospace;font-size:20px;text-align:center;padding:8px;" onclick="if(this.style.backgroundColor =='red'){document.getElementById('attbox').style.display='none';this.style.borderBottom='none';this.style.backgroundColor ='aqua';}else{document.getElementById('attbox').style.display='flex';this.style.borderBottom='solid 2px black';this.style.backgroundColor ='red';}">Attendance Control</div>
<div class="flex" id="attbox" style="display:none;">
</div>
</div>


<div style="height:1376px;width:1048px;border:1px solid black;font-family:monospace;font-size:20px;margin-top:10px;" id="finallook"  onclick="">
<div style="height:400px;width:1048px;display:flex;flex-direction:column;justify-content:space-around;">
<div style="height:100px;width:100px;background:url(1.png);background-size:cover;align-self:center;"></div>
<div style="height:250px;width:848px;display:flex;flex-direction:column;width:100%;">
<div style="font-size:25px;align-self:center;width:fit-content;">Osmania Medical College Attendance Sheet</div>
<div class="flex" style=""><div style="" id="subjfld">Subject : </div><div id="timefld" style="">Time : </div><div style="" id="datefld">Date : </div></div>
<div class="flex" style=""><div style="" id="rollfld">Roll No : </div><div style="" id="bachfld">Batches : </div><div style="" id="factfld">Administered by : </div></div>
</div>
</div>
<div style="height:960px;width:1048px;display:flex;align-self:end;margin-bottom:15px;justify-content:space-around;" id="">
<div style="height:960px;width:1048px;display:flex;align-self:end;margin-bottom:15px;justify-content:space-around;" id="attsht"></div>
<div style="position:absolute;background:url(1.png);background-repeat:no-repeat;background-size:100% 100%;width: 960px;height: 960px;opacity: 15%;"></div>
</div>
</div>
<div style="height:1376px;width:1048px;" id="screenshot"></div>
</div>
</div>
<div style="display:none;" id="msguifb"></div>
<div style="display:none;" id="msgidb"></div>
<div id="tdiv" style="display:none;"></div>
<button type="button" id="cngshtb" style="display:none;width:50%;background-color:red;font-family:monospace;font-size:20px;text-align:center;padding:8px;margin:auto;" onclick='chngsht();'>Change Sheet</button>
<script>
//https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/sendmessage?chat_id=-1001310291767&text=bye

$('#strtimpic').timepicker({'scrollDefault':'now','timeFormat': 'h:mm a','minTime': '8:00am','maxTime': '6:00pm','step': 15});
$('#endtimpic').timepicker({'scrollDefault':'now','timeFormat': 'h:mm a','minTime': '8:00am','maxTime': '6:00pm','step': 15});
$('#endtimbut').on('click', function (){
	$('#endtimpic').timepicker('setTime', new Date());
});

var arr = [], rcl=[];
var screenshot = document.getElementById("screenshot");
var resp, rollnoc, prel=[], absl=[], copl=[], pprel=[], pabsl=[], xhttp, msgid, etrc, studcon, arrol;
var atbe=document.getElementById("attbox"), absbox=document.getElementById("absudbox"), prebox=document.getElementById("presudbox");
var batches, urlfs, caption, bstr;
var rrrrr='', bps, pv=1, nt=42, i=1, j=1, tmparr, setroom, rollary=[], pal=[];

var attboxtbsf='<table class="main" onclick="onclk(event);"><thead><tr><td>Roll No:</td><td>Button</td></tr></thead><tbody id="attboxtb', attboxtbss='"></tbody></table>';
var attboxtr1='<tr class="each"><td class="rn">', attboxtr2='</td><td class="pa" rollno=', attboxtr3=' id="attcon', attboxtr4='"><div class="pre"></div><div class="abs"></div></td></tr>', attboxtr5='"><div class="pre"></div><div class="abs"></div></td></tr>';

var apb1='<div class="flexc"><div class="apb">', apb2='</div><div class="apbab" id="apbstu', apb3='</div><div class="apbpr" id="apbstu', apb4='"></div></div>';

var cb1='<div class="flexc"><div class="apb" >', cb2='</div><div class="apbab" id="cstu', cb3='</div><div class="apbpr" id="cstu', cb4='" ></div></div>', chngbv=document.getElementById("chngb"), tdiv=document.getElementById("tdiv");

var multiadm=true, msguif='';

// start of toolchk which select and unselect batches 
function toolchk(rrr){
if(rrr==1){
document.getElementById("bata").checked=false;document.getElementById("batb").checked=false;document.getElementById("batc").checked=false;
}else if(rrr==2){
document.getElementById("bata").checked=true;document.getElementById("batb").checked=true;document.getElementById("batc").checked=true;
}
}

// start of crtshtini which confirm starting 
function crtshtini(){
swal({title: "Are you sure?",text: "It will start Attendance System",icon: "warning",buttons: true,dangerMode: true,}).then((value) => {if(value){swal({icon: "success",title:"Done",text:"Attendance System Started"});crtsht();}else{swal({title:"Cancelled Process",icon:"info"});}});
}

// start of abplch which edit boxes every time 
function abplch(){
   absbox.innerHTML='';
   prebox.innerHTML='';
   for(item of absl){absbox.innerHTML+=apb1+item+apb2+item+apb4;}
   for(item of prel){prebox.innerHTML+=apb1+item+apb3+item+apb4;}
}

// start of onclk event onlick 
function onclk(event) {
    if(event.target.closest(".pre")){
       rollnoc = Math.floor(event.target.closest(".pa").getAttribute("rollno"));
	   if(prel.includes(rollnoc)){
	       
	   }else{
	    prel.push(rollnoc);
		prel.sort(function(a, b){return a-b});
		pal[copl.indexOf(rollnoc)]="P";
		if(absl.includes(rollnoc)){
		   absl.splice(absl.indexOf(rollnoc),1);
		   event.target.closest(".pre").nextElementSibling.style.border = "5px solid #d6bc14";
		 }
		if(rcl.includes(rollnoc)){
			rcl.splice(rcl.indexOf(rollnoc),1);
			rcl.sort(function(a, b){return a-b});
			document.getElementById(("cstu"+rollnoc)).parentNode.remove();
		}else{
			rcl.push(rollnoc);
			rcl.sort(function(a, b){return a-b});
			if(rcl.length){
				if(rcl.indexOf(rollnoc) == 0){
					tdiv.innerHTML = cb1+rollnoc+cb3+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rcl[1])));
				}else if(rcl.indexOf(rollnoc) == (rcl.length - 1)){
					chngbv.innerHTML += cb1+rollnoc+cb3+rollnoc+cb4;
				}else{
					tdiv.innerHTML = cb1+rollnoc+cb3+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rollnoc)), document.getElementById(("cstu"+rcl[(rcl.indexOf(rollnoc) + 1)])));
				}
			}else{
				chngbv.innerHTML = cb1+rollnoc+cb3+rollnoc+cb4;
			}
		}
		abplch();
		document.getElementById("tdap"+rollnoc).innerText="P";
		event.target.closest(".pre").style.border = "5px solid lime";
	   }
    }else if(event.target.closest(".abs")){
       rollnoc = Math.floor(event.target.closest(".pa").getAttribute("rollno"));
	   if(absl.includes(rollnoc)){
	       
	   }else{
	    absl.push(rollnoc);
		absl.sort(function(a, b){return a-b});
		pal[copl.indexOf(rollnoc)]="A";
		if(prel.includes(rollnoc)){
		   prel.splice(prel.indexOf(rollnoc),1);
		   prel.sort(function(a, b){return a-b});
		   event.target.closest(".abs").previousElementSibling.style.border = "5px solid #d6bc14";
		}
		if(rcl.includes(rollnoc)){
			rcl.splice(rcl.indexOf(rollnoc),1);
			rcl.sort(function(a, b){return a-b});
			document.getElementById(("cstu"+rollnoc)).parentNode.remove();
		}else{
			rcl.push(rollnoc);
			rcl.sort(function(a, b){return a-b});
			if(rcl.length){
				if(rcl.indexOf(rollnoc) == 0){
					tdiv.innerHTML = cb1+rollnoc+cb2+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rcl[1])));
				}else if(rcl.indexOf(rollnoc) == (rcl.length - 1)){
					chngbv.innerHTML += cb1+rollnoc+cb2+rollnoc+cb4;
				}else{
					tdiv.innerHTML = cb1+rollnoc+cb2+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rollnoc)), document.getElementById(("cstu"+rcl[(rcl.indexOf(rollnoc) + 1)])));
				}
			}else{
				chngbv.innerHTML = cb1+rollnoc+cb2+rollnoc+cb4;
			}
		}
		abplch();
		document.getElementById("tdap"+rollnoc).innerText="A";
		event.target.closest(".abs").style.border = "5px solid red";
	   }
	}else if(event.target.closest(".apbpr")){
       rollnoc = Math.floor(event.target.closest(".apbpr").getAttribute("id").replace('apbstu',''));
	   if(prel.includes(rollnoc)){
	       
	   }else{
	    prel.push(rollnoc);
		prel.sort(function(a, b){return a-b});
		pal[copl.indexOf(rollnoc)]="P";
		document.getElementById("attcon"+rollnoc).getElementsByClassName('pre')[0].style.border='5px solid lime';
		document.getElementById("attcon"+rollnoc).getElementsByClassName('abs')[0].style.border='5px solid #d6bc14';
		if(absl.includes(rollnoc)){
		absl.splice(absl.indexOf(rollnoc),1);
		absl.sort(function(a, b){return a-b});
		}
		if(rcl.includes(rollnoc)){
			rcl.splice(rcl.indexOf(rollnoc),1);
			rcl.sort(function(a, b){return a-b});
			document.getElementById(("cstu"+rollnoc)).parentNode.remove();
		}else{
			rcl.push(rollnoc);
			rcl.sort(function(a, b){return a-b});
			if(rcl.length){
				if(rcl.indexOf(rollnoc) == 0){
					tdiv.innerHTML = cb1+rollnoc+cb3+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rcl[1])));
				}else if(rcl.indexOf(rollnoc) == (rcl.length - 1)){
					chngbv.innerHTML += cb1+rollnoc+cb3+rollnoc+cb4;
				}else{
					tdiv.innerHTML = cb1+rollnoc+cb3+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rollnoc)), document.getElementById(("cstu"+rcl[(rcl.indexOf(rollnoc) + 1)])));
				}
			}else{
				chngbv.innerHTML = cb1+rollnoc+cb3+rollnoc+cb4;
			}
		}
		abplch();
		document.getElementById("tdap"+rollnoc).innerText="P";
	   }
	}else if(event.target.closest(".apbab")){
           rollnoc = Math.floor(event.target.closest(".apbab").getAttribute("id").replace('apbstu',''));
	   if(absl.includes(rollnoc)){
	       
	   }else{
	     absl.push(rollnoc);
		 absl.sort(function(a, b){return a-b});
		 pal[copl.indexOf(rollnoc)]="A";
		 document.getElementById("attcon"+rollnoc).getElementsByClassName('abs')[0].style.border='5px solid red';
		 document.getElementById("attcon"+rollnoc).getElementsByClassName('pre')[0].style.border='5px solid #d6bc14';
		 if(prel.includes(rollnoc)){
		 prel.splice(prel.indexOf(rollnoc),1);
		 prel.sort(function(a, b){return a-b});
		 }
		if(rcl.includes(rollnoc)){
			rcl.splice(rcl.indexOf(rollnoc),1);
			rcl.sort(function(a, b){return a-b});
			document.getElementById(("cstu"+rollnoc)).parentNode.remove();
		}else{
			rcl.push(rollnoc);
			rcl.sort(function(a, b){return a-b});
			if(rcl.length){
				if(rcl.indexOf(rollnoc) == 0){
					tdiv.innerHTML = cb1+rollnoc+cb2+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rcl[1])));
				}else if(rcl.indexOf(rollnoc) == (rcl.length - 1)){
					chngbv.innerHTML += cb1+rollnoc+cb2+rollnoc+cb4;
				}else{
					tdiv.innerHTML = cb1+rollnoc+cb2+rollnoc+cb4;
					chngbv.insertBefore(document.getElementById(("cstu"+rollnoc)), document.getElementById(("cstu"+rcl[(rcl.indexOf(rollnoc) + 1)])));
				}
			}else{
				chngbv.innerHTML = cb1+rollnoc+cb2+rollnoc+cb4;
			}
		}
		abplch();
		document.getElementById("tdap"+rollnoc).innerText="A";
	   }
	}
}
// end of onclk event onlick 

// start of crtsht create sheet
function crtsht(){
document.getElementById("atctrl").style.display="none";
tmparr=[];
rollary=[0,0];
tmparr.push("many");
tmpstr='';
if(document.getElementById("bata").checked){tmparr.push("A");rollary[0]=1;rollary[1]=83;tmpstr+='-A';}
if(document.getElementById("batb").checked){tmparr.push("B");if(rollary[0]==0){rollary[0]=84;}rollary[1]=166;tmpstr+='-B';}
if(document.getElementById("batc").checked){tmparr.push("C");if(rollary[0]==0){rollary[0]=167;}rollary[1]=235;tmpstr+='-C';}
bstr=tmpstr;
document.getElementById("subjfld").innerText="Subject : "+document.getElementById("subji").value;
document.getElementById("timefld").innerText="Time : "+document.getElementById("strtimpic").value+"-"+document.getElementById("endtimpic").value;
document.getElementById("datefld").innerText= "Date : "+new Date().toDateString();
document.getElementById("rollfld").innerText= "Roll No : "+rollary[0]+"-"+rollary[1];
document.getElementById("factfld").innerText= "Administered by: "+document.getElementById("facti").value;
document.getElementById("bachfld").innerText= "Batches :"+bstr;
drawatt(tmparr);
}
// end of crtsht create sheet

// start of drawatt draw sheet
function drawatt(lv){

addEventListener("beforeunload", unld);

atbe.innerHTML='';
absbox.innerHTML='';
prebox.innerHTML='';
document.getElementById("attsht").innerHTML='';
u=0;

studcon=0, absl=[], prel=[], copl=[], pal=[], rcl=[], batches='';
arrol=[];
if(lv.includes("A")){
arrol.push([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]);
arrol.push([29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56]);
arrol.push([57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83]);
studcon+=83;
batches+='As';
}
if(lv.includes("B")){
arrol.push([84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111]);
arrol.push([112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139]);
arrol.push([140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166]);
studcon+=83;
batches+='Bs';
}
if(lv.includes("C")){
arrol.push([167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194]);
arrol.push([195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,220,221,222,223]);
arrol.push([224,225,226,227,228,229,230,231,232,233,234,235]);
studcon+=69;
batches+='Cs';
}
if(lv.includes("many")){
j=1;
i=1;
etrc = Math.ceil(studcon/(Math.floor((document.body.offsetWidth-40)/180)));
for(sbar of arrol){
document.getElementById("attsht").innerHTML += '<table class="main" ><thead><tr class="" style="background:silver;"><td class="imgtr">Rno</td></td><td class="imgta">?</td></tr></thead><tbody id="attentab'+i+'"></tbody></table>';
for(item of sbar){
	if(1===((j)%etrc)){
	  atbe.innerHTML+=attboxtbsf+(u+1)+attboxtbss;
	  u++;
	}
	//prebox.innerHTML+=apb1+item+apb3+item+apb4;
	if(multiadm){
		pal.push("A");
		absl.push(item);
		document.getElementById("attentab"+i).innerHTML+='<tr class="dumy"><td class="imgtr">'+item+'</td><td id="tdap'+item+'" class="imgta">A</td></tr>';
		document.getElementById("attboxtb"+u).innerHTML+=attboxtr1+item+attboxtr2+item+attboxtr3+item+attboxtr5;
	}else{
		pal.push("P");
		prel.push(item);
		document.getElementById("attentab"+i).innerHTML+='<tr class="dumy"><td class="imgtr">'+item+'</td><td id="tdap'+item+'" class="imgta">P</td></tr>';
		document.getElementById("attboxtb"+u).innerHTML+=attboxtr1+item+attboxtr2+item+attboxtr3+item+attboxtr4;
	}
	copl.push(item);
	j=j+1;
}
i++;
}
document.getElementById("attboxtb"+u).closest(".main").style.height=((studcon%etrc)*48)+'px';
abplch();
}
// here made JSON of our batches
tmpstr='{';
i=0;
for(item of pal){tmpstr+=('"'+copl[i]+'":"'+item+'",');i++;}
tmpstr+='"tmp":"t"}';

var xhttf = new XMLHttpRequest();
xhttf.responseType="json";
xhttf.onreadystatechange = function(){if(this.readyState == 4 && this.status == 200){
	if(xhttf.response.room1=="no"){setroom=1;}else if(xhttf.response.room2=="no"){setroom=2;}else if(xhttf.response.room3=="no"){setroom=3;}else if(xhttf.response.room4=="no"){setroom=4;}
	var xhttt = new XMLHttpRequest();
	xhttt.onreadystatechange = function(){if(this.readyState == 4 && this.status == 200){
	var xhtto = new XMLHttpRequest();
	xhtto.onreadystatechange = function(){if(this.readyState == 4 && this.status == 200){
	//urlfs = "https://osmaniastudent.github.io/as/ats.html?"+setroom+"sss"+batches;
	caption=encodeURI("Subject : "+document.getElementById("subji").value+"  Date : "+new Date().toDateString()+"  Time: "+document.getElementById("strtimpic").value+"-"+document.getElementById("endtimpic").value+"  Batches :"+bstr+" Roll No: "+rollary[0]+"-"+rollary[1]+"  Administered by: "+document.getElementById("facti").value);
	var xtthp = new XMLHttpRequest();
	xtthp.responseType="json";
	xtthp.onreadystatechange = function(){if(this.readyState == 4 && this.status == 200){document.getElementById("msguifb").innerText=(this.response.result.message_id);
	msguif = document.getElementById("msguifb").innerText;
	remain();
	}};
	xtthp.open("GET", ("https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/sendmessage?chat_id=-1001310291767&text="+caption), true);
	xtthp.send();
	}};
	xhtto.open("PUT", ('https://fitbeau-5606d.firebaseio.com/room/room'+setroom+'/apcl.json'), true);
	xhtto.setRequestHeader("Content-Type", "application/json");
	// here send JSON of our batches
	//console.log(JSON.stringify(tmpstr));
	xhtto.send(tmpstr);
	}};
	xhttt.open("PUT", ('https://fitbeau-5606d.firebaseio.com/room/inuse/room'+setroom+'.json'), true);
	xhttt.send('"yes"');
}};
xhttf.open("GET", ("https://fitbeau-5606d.firebaseio.com/room/inuse/.json"), true);
xhttf.send();
}
// end of drawatt draw sheet

// start of remain after drawatt
function remain(){
var coda = Math.floor(Math.random(8)*(100)) + 100;
document.getElementById("kode").innerText=coda;
var admurl = "https://osmaniastudent.github.io/as/admin2.html?"+setroom+"zzz"+(coda*77+9);
var xhttu = new XMLHttpRequest();
xhttu.onreadystatechange = function() {if (this.readyState == 4 && this.status == 200) {
var xhttp = new XMLHttpRequest();
xhttp.responseType = 'json';
xhttp.onreadystatechange = function() {if (this.readyState == 4 && this.status == 200) {document.getElementById("msgidb").innerText=(this.response.result.message_id);
msgid = document.getElementById("msgidb").innerText;
document.getElementById("help").style.display="block";
document.getElementById("attbox").style.display="flex";
document.getElementById("atctrl").style.display="block";
document.getElementById("crsbut").disabled = true;
document.getElementById("cngshtb").style.display="block";
}};
xhttp.open("GET", ("https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/sendmessage?chat_id=-1001310291767&text=loading.."), true);
xhttp.send();
}};
xhttu.open("GET", ("https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/sendmessage?chat_id=-1001310291767&text="+encodeURI(admurl)), true);
xhttu.send();
}
// end of remain use the sheet now

// start of editgms editing loading.. message
function editgms(){
   var tmpstr1='🅰️ :';
   //var tmpstr2='\n🅿️ :';
   var xhttpe = new XMLHttpRequest();
   xhttpe.responseType="json";
   xhttpe.onreadystatechange = function(){if (this.readyState == 4 && this.status == 200) {
   var respe = this.response;
   var i=0;
   for (items in respe){
	if(respe[items]=='A'){
	   tmpstr1+=(" "+copl[i]+",");
	}
	i++;
   }
   var xhttps = new XMLHttpRequest();
   xhttps.open("GET", ('https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/editMessageText?chat_id=-1001310291767&message_id='+msgid+'&text='+encodeURI(tmpstr1)), true);
   xhttps.send();
  }};								  
   xhttpe.open("GET", ('https://fitbeau-5606d.firebaseio.com/room/room'+setroom+'/apcl/.json'), true);
   xhttpe.send();
}
// end of editgms edited loading.. message

// start of refreshl refreshing prel and absl
function refreshl(){
   pabsl = absl;
   pprel = prel;
   absl = [];
   prel = [];
   var xhttpe = new XMLHttpRequest();
   xhttpe.responseType = 'json';
   xhttpe.onreadystatechange = function(){if (this.readyState == 4 && this.status == 200) {
   var respe = this.response;
   var i=0;
   for (items in respe){
   if (rcl.includes(Math.floor(items))){
        if (pabsl.includes(Math.floor(items))){
			absl.push(Math.floor(items))
		}else if (pprel.includes(Math.floor(items))){
			prel.push(Math.floor(items));
		}
   }else if(respe[items]=='A'){
		absl.push(Math.floor(items));
		pal[i]="A";
		document.getElementById("attcon"+copl[i]).getElementsByClassName('pre')[0].style.border='5px solid #d6bc14';
		document.getElementById("attcon"+copl[i]).getElementsByClassName('abs')[0].style.border='5px solid red';
   }else if(respe[items]=='P'){
		prel.push(Math.floor(items));
		pal[i]="P";
		document.getElementById("attcon"+copl[i]).getElementsByClassName('pre')[0].style.border='5px solid lime';
		document.getElementById("attcon"+copl[i]).getElementsByClassName('abs')[0].style.border='5px solid #d6bc14';
   }
   i++;
   }
   abplch();
  }};
   xhttpe.open("GET", ('https://fitbeau-5606d.firebaseio.com/room/room'+setroom+'/apcl/.json'), true);
   xhttpe.send();
}
// end of refreshl refreshed prel and absl

// start of endatts final ending door
function endatts(){
  var xhttm = new XMLHttpRequest();
  xhttm.onreadystatechange = function(){if (this.readyState == 4 && this.status == 200) {
  editgms();
  }};
  xhttm.open("PUT", ('https://fitbeau-5606d.firebaseio.com/room/inuse/room'+setroom+'.json'), true);
  xhttm.send('"no"');
}
// end of endatts exited and submited

// start of chngsht handles the sheet changing
function chngsht(){
	//urlfs = "https://osmaniastudent.github.io/as/ats.html?"+setroom+"sss"+batches;
	caption=encodeURI("Subject : "+document.getElementById("subji").value+"  Date : "+new Date().toDateString()+"  Time: "+document.getElementById("strtimpic").value+"-"+document.getElementById("endtimpic").value+"  Batches :"+bstr+" Roll No: "+rollary[0]+"-"+rollary[1]+"  Administered by: "+document.getElementById("facti").value);
	var xtthp = new XMLHttpRequest();
	xtthp.onreadystatechange = function(){if(this.readyState == 4 && this.status == 200){
		document.getElementById("subjfld").innerText="Subject : "+document.getElementById("subji").value;
		document.getElementById("timefld").innerText="Time : "+document.getElementById("strtimpic").value+"-"+document.getElementById("endtimpic").value;
		document.getElementById("factfld").innerText= "Administered by: "+document.getElementById("facti").value;
	}};
	xtthp.open("GET", ("https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/editMessageText?chat_id=-1001310291767&message_id="+msguif+"&text="+caption), true);
	xtthp.send();
}
// end of chngsht changed the sheet

// start of sendimg which send canvas image
function sendimg(idoe){
  html2canvas(idoe, {
    allowTaint: true,
    taintTest: false,
    type: "view",
  }).then(function(canvas){
    canvas.toBlob(function (blob){var formData = new FormData();formData.append('photo', blob);formData.append('caption', "Sheet");
	   var reque = new XMLHttpRequest();
	   reque.open("POST", "https://api.telegram.org/bot5983894147:AAF31AIhn2NAqrlejK-1BDvaZNoj1a2o4N0/sendPhoto?chat_id=-1001310291767");
	   reque.send(formData);
       canvas.style.width = "100%"; screenshot.innerHTML='';screenshot.appendChild(canvas);
	   editgms();
    },"image/jpeg",1);
  });
}
// end of sendimg sended canvas image
	
function info(rn){
  //swal({title:(rn+" is:"),icon:"info",text:(arr[Number(rn)][1])});
}

// called when page id unloading
function unld(e){
	e.preventDefault();
	//endatts();
	swal("Please complete the attendance");
}

/*
if(document.getElementById('mae').checked){
   multiadm=true;
}else if(document.getElementById('mad').checked){
   multiadm=false;
}else{
   swal("Error","Multiple Admin not defined","error");
   return;
}

else if(lv.includes("custom")){
//lv=["custom",1,26] for 1-25
j=lv[1];
etrc = Math.ceil((lv[2]-lv[1])/(Math.floor(document.body.offsetWidth/160)));
while(j<lv[2]){
	if(1===(((j-lv[1])+1)%etrc)){
	  atbe.innerHTML+=attboxtbsf+(u+1)+attboxtbss;
	  u++;
	}
	document.getElementById("attboxtb"+u).innerHTML+=attboxtr1+j+attboxtr2+j+attboxtr3+j+attboxtr4;
	j=j+1;
}
}

editgms();

else if(respe[items]=='P'){
	   tmpstr2+=(" "+copl[i]+",");
}
*/

</script>
</body>
</html>
